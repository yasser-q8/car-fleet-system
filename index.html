<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø£Ø³Ø·ÙˆÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª - Ø´Ø±ÙƒØ© Ù†Ø§ÙŠÙ Ù„Ù„Ø£ØºØ°ÙŠØ©</title>
    <link rel="icon" href="https://i.postimg.cc/NM2zJWZD/NAIF-LOGO.jpg">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary-red: #FF0000;
            --phosphorescent-green: #39FF14;
            --light-sky-blue: #87CEEB;
            --white: #FFFFFF;
            --dark-blue: #1E3A8A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-sky-blue);
            color: #333;
            line-height: 1.6;
        }

        .container {
            width: 97%;
            max-width: 1350px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--primary-red);
            color: white;
            padding: 20px 0;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .company-logo-header {
            max-width: 60px;
            max-height: 60px;
            object-fit: contain;
            border-radius: 50%;
            border: 2px solid white;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .company-name-header {
            font-size: 16px;
            margin-top: 5px;
            color: white;
        }

        .nav-tabs {
            display: flex;
            background-color: var(--dark-blue);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .nav-tab {
            padding: 12px 20px;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
            text-align: center;
            flex: 1;
        }

        .nav-tab:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .nav-tab.active {
            background-color: var(--primary-red);
        }

        .content-section {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            color: var(--primary-red);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--phosphorescent-green);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background-color: var(--dark-blue);
            color: white;
            cursor: pointer;
        }

        .data-table tr:hover {
            background-color: #f5f5f5;
        }

        .search-box {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .search-box input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-red);
            color: white;
        }

        .btn-secondary {
            background-color: var(--phosphorescent-green);
            color: var(--dark-blue);
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }

        .btn-info {
            background-color: #17a2b8;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--dark-blue);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .alert-warning {
            background-color: #dc3545;
            color: white;
            border: 1px solid #c82333;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .compact-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
        }

        .compact-form-2 {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr;
            gap: 15px;
        }

        .search-results {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: var(--phosphorescent-green);
            color: #333;
            position: absolute;
            width: 100%;
            z-index: 1000;
            display: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .search-result-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            transition: background-color 0.2s;
        }

        .search-result-item:hover {
            background-color: rgba(255,255,255,0.5);
        }

        .form-container {
            position: relative;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }

        .stat-card.license {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
        }

        .stat-card.ad-license {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-red);
        }

        .error-message {
            color: #dc3545;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close-modal:hover {
            color: #000;
        }

        .company-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .company-logo {
            max-width: 100px;
            max-height: 60px;
            object-fit: contain;
        }

        .company-info {
            flex: 1;
        }

        .file-input {
            display: none;
        }

        .file-input-label {
            display: inline-block;
            padding: 10px 15px;
            background-color: var(--primary-red);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            background-color: #cc0000;
        }

        /* ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .signature-card {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, #FF6E00, #2196F3);
            color: white;
            padding: 10.5px 17.5px;
            border-radius: 8.5px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 1000;
            animation: float 6s ease-in-out infinite;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .signature-card:hover { 
            transform: scale(1.05); 
            box-shadow: 0 12px 35px rgba(0,0,0,0.4); 
        }

        @keyframes float { 
            0% { transform: translateY(0px); } 
            50% { transform: translateY(-15px); } 
            100% { transform: translateY(0px); } 
        }

        .signature-card::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(135deg, #80EF80, #2196F3);
            border-radius: 14px;
            z-index: -1;
            animation: borderGlow 3s linear infinite;
            background-size: 400%;
        }

        @keyframes borderGlow { 
            0% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
            100% { background-position: 0% 50%; } 
        }

        .signature-card .name { 
            font-size: 0.95rem; 
            font-weight: 700; 
            margin-bottom: 5px; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3); 
        }

        .signature-card .title { 
            font-size: 0.7rem; 
            opacity: 0.9; 
            font-weight: 500; 
        }

        @media (max-width: 768px) { 
            .signature-card { 
                position: relative; 
                bottom: auto; 
                left: auto; 
                margin: 20px auto 0; 
                width: fit-content; 
                animation: none; 
            } 
            .signature-card:hover { 
                transform: none; 
            } 
        }

        @media print {
            .signature-card {
                display: none;
            }
        }

        .alerts-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .alerts-table th, .alerts-table td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }
        
        .alerts-table th {
            background-color: var(--dark-blue);
            color: white;
        }
        
        .alerts-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .alerts-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .days-remaining {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 15px;
            text-align: center;
        }
        
        .days-critical {
            background-color: #ffcccc;
            color: #cc0000;
        }
        
        .days-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .days-normal {
            background-color: #d4edda;
            color: #155724;
        }
        
        .days-expired {
            background-color: #ffcccc;
            color: #cc0000;
            font-weight: bold;
        }

        .receipt-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .receipt-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary-red);
            padding-bottom: 20px;
        }
        
        .receipt-logo {
            max-width: 120px;
            max-height: 80px;
            object-fit: contain;
            margin-bottom: 15px;
            border-radius: 50%;
            border: 2px solid var(--primary-red);
        }
        
        .receipt-title {
            color: var(--primary-red);
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .receipt-company {
            color: var(--dark-blue);
            font-size: 18px;
        }
        
        .receipt-details {
            margin-bottom: 30px;
        }
        
        .receipt-details h3 {
            color: var(--primary-red);
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .signature-container {
            margin-top: 30px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        
        .signature-box {
            width: 100%;
            height: 100px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }
        
        .signature-label {
            text-align: center;
            margin-top: 5px;
            font-weight: bold;
            color: #666;
        }
        
        .car-sketch-container {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            background-color: #f9f9f9;
            overflow: visible;
        }
        
        .car-sketch {
            position: relative;
            width: 190px;
            height: 280px;
            background-color: #f8f9fa;
            border-radius: 5px;
            margin: 0 auto 15px;
            overflow: hidden;
            border: 1px solid #dee2e6;
        }
        
        .car-body {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 100px;
            background-color: rgba(108, 117, 125, 0.1);
            border-radius: 10px;
            border: 1px solid #6c757d;
        }
        
        .car-front {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            width: 20%;
            height: 80px;
            background-color: rgba(73, 80, 87, 0.1);
            border-radius: 5px 0 0 5px;
            border: 1px solid #495057;
        }
        
        .car-rear {
            position: absolute;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            width: 20%;
            height: 80px;
            background-color: rgba(73, 80, 87, 0.1);
            border-radius: 0 5px 5px 0;
            border: 1px solid #495057;
        }
        
        .car-window {
            position: absolute;
            top: 10px;
            left: 25%;
            width: 50%;
            height: 40px;
            background-color: rgba(160, 210, 255, 0.2);
            border-radius: 5px;
            border: 1px solid #a0d2ff;
        }
        
        .car-wheel {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: #343a40;
            border-radius: 50%;
        }
        
        .wheel-front {
            top: 85px;
            left: 20%;
        }
        
        .wheel-rear {
            top: 85px;
            right: 20%;
        }
        
        .car-direction {
            position: absolute;
            font-size: 12px;
            font-weight: bold;
            color: #333;
        }
        
        .front-direction {
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .rear-direction {
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .scratch-point {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #dc3545;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
        }
        
        .scratch-list {
            margin-top: 15px;
        }
        
        .scratch-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background-color: white;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 4px solid #dc3545;
        }
        
        .scratch-location {
            font-weight: bold;
        }
        
        .remove-scratch {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 3px 8px;
            cursor: pointer;
        }

        .alerts-bar {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .alerts-count {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .alert-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .alert-badge {
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .receipt-details .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .receipt-details .data-table th,
        .receipt-details .data-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: right;
            width: 25%;
        }

        .receipt-details .data-table th {
            background-color: #f5f5f5;
            font-weight: bold;
            color: #333;
        }

        .receipt-details .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .receipt-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .receipt-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--primary-red);
            padding-bottom: 10px;
        }

        .receipt-header-text {
            flex: 1;
        }

        .receipt-table {
            font-size: 14px;
            margin-bottom: 15px;
        }

        .receipt-table th, 
        .receipt-table td {
            padding: 6px 8px;
            border: 1px solid #ddd;
        }

        .receipt-details {
            margin-bottom: 15px;
        }

        .car-sketch-container {
            margin-top: 10px;
            padding: 5px;
        }

        .signature-container {
            margin-top: 15px;
            padding-top: 10px;
        }

        /* Ù‚Ø§Ù„Ø¨ PDF Ø§Ù„Ù…Ø®ÙÙŠ */
        .pdf-template {
            position: fixed;
            left: -10000px;
            top: -10000px;
            width: 794px;
            height: 1123px;
            background: white;
            padding: 10px;
            box-sizing: border-box;
            z-index: -1000;
            font-size: 12px;
            font-family: 'Times New Roman', serif;
        }

        .pdf-header {
            padding: 5px;
            margin-bottom: 10px;
            padding-left: 30px;
        }

        .pdf-header-row {
            text-align: center;
        }

        .pdf-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--primary-red);
            margin: 0 auto 5px;
            display: block;
        }

        .pdf-title {
            color: var(--primary-red);
            margin: 0;
            font-size: 18px;
        }

        .statement-table {
            font-size: 10px;
            border-collapse: collapse;
            width: calc(100% - 40px);
            margin-left: 30px;
        }

        .statement-table th {
            padding: 4px;
            border: 1px solid #000;
            text-align: center;
            background: var(--primary-red);
            color: white;
        }

        .statement-table td {
            padding: 4px;
            border: 1px solid #000;
            text-align: center;
        }

        @media (max-width: 768px) {
            .receipt-details .data-table th,
            .receipt-details .data-table td {
                width: 50%;
                display: block;
            }
            
            .receipt-details .data-table tr {
                display: block;
                margin-bottom: 10px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .logo-section {
                flex-direction: column;
                margin-bottom: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .compact-form, .compact-form-2 {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .car-sketch {
                width: 300px;
                height: 150px;
            }
            
            .alerts-bar {
                flex-direction: column;
                gap: 10px;
            }
            
            .alerts-count {
                justify-content: center;
            }
            
            .alert-badge {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø·ÙˆØ± (Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯) -->
    <div class="signature-card">
        <div class="name">Yasser Elkhateeb</div>
        <div class="title">Ù…Ø·ÙˆØ± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ 67011143</div>
    </div>

    <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div id="appScreen">
        <div class="container">
            <header>
                <div class="header-content">
                    <div class="logo-section">
                        <img id="companyLogoHeader" src="https://i.postimg.cc/NM2zJWZD/NAIF-LOGO.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©" class="company-logo-header">
                        <div>
                            <div class="logo">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø£Ø³Ø·ÙˆÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</div>
                            <div class="company-name-header">Ø´Ø±ÙƒØ© Ù†Ø§ÙŠÙ Ù„Ù„Ø£ØºØ°ÙŠØ©</div>
                        </div>
                    </div>
                    <div class="user-info">
                        <span>Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                    </div>
                </div>
            </header>

            <div class="nav-tabs">
                <div class="nav-tab active" data-target="reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
                <div class="nav-tab" data-target="alerts">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
                <div class="nav-tab" data-target="cars-data">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</div>
                <div class="nav-tab" data-target="delivery-receipt">ØªØ³Ù„ÙŠÙ…/Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</div>
                <div class="nav-tab" data-target="car-history">ÙƒØ´Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©</div>
                <div class="nav-tab" data-target="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <section id="reports" class="content-section active">
                <h2 class="section-title">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h4>
                        <p class="stat-number" id="totalCarsCount">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h4>
                        <p class="stat-number" id="activeCarsCount">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</h4>
                        <p class="stat-number" id="maintenanceCarsCount">0</p>
                    </div>
                    <div class="stat-card license">
                        <h4>ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ù‚Ø±ÙŠØ¨Ø§Ù‹</h4>
                        <p class="stat-number" id="expiringLicensesCount">0</p>
                    </div>
                    <div class="stat-card ad-license">
                        <h4>ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ù‚Ø±ÙŠØ¨Ø§Ù‹</h4>
                        <p class="stat-number" id="expiringAdLicensesCount">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ø´Ø·Ø©</h4>
                        <p class="stat-number" id="activeDeliveriesCount">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</h4>
                        <p class="stat-number" id="totalRestaurantsCount">0</p>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="monthlyReport">ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</button>
                    <button class="btn btn-primary" id="yearlyReport">ØªÙ‚Ø±ÙŠØ± Ø³Ù†ÙˆÙŠ</button>
                    <button class="btn btn-primary" id="expiryReport">ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©</button>
                    <button class="btn btn-secondary" id="exportReport">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                </div>

                <div id="reportResults" style="margin-top: 20px;"></div>
            </section>

            <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…ÙØµÙ„Ø© -->
            <section id="alerts" class="content-section">
                <h2 class="section-title">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h2>
                
                <div id="licenseAlert" class="alert alert-warning" style="display: none;">
                    <strong>ØªÙ†Ø¨ÙŠÙ‡:</strong> <span id="alertMessage"></span>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="refreshAlerts">ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</button>
                    <button class="btn btn-secondary" id="exportAlerts">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</button>
                </div>
                
                <h3>Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©</h3>
                <table class="alerts-table" id="expiringLicensesTable">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                            <th>Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                            <th>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</th>
                        </tr>
                    </thead>
                    <tbody id="expiringLicensesTableBody"></tbody>
                </table>
            </section>

            <!-- Ù‚Ø³Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª -->
            <section id="cars-data" class="content-section">
                <h2 class="section-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h2>
                
                <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®ØªØµØ± -->
                <div id="alertsBar" class="alerts-bar" style="display: none;">
                    <div class="alerts-count">
                        <div class="alert-item">
                            <span>ØªØ±Ø§Ø®ÙŠØµ Ø³ÙŠØ§Ø±Ø§Øª Ù…Ù†ØªÙ‡ÙŠØ©:</span>
                            <span class="alert-badge" id="licenseAlertCount">0</span>
                        </div>
                        <div class="alert-item">
                            <span>ØªØ±Ø§Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù† Ù…Ù†ØªÙ‡ÙŠØ©:</span>
                            <span class="alert-badge" id="adLicenseAlertCount">0</span>
                        </div>
                        <div class="alert-item">
                            <span>ØªØ±Ø§Ø®ÙŠØµ Ø³ÙŠØ§Ø±Ø§Øª Ù…Ù†ØªÙ‡ÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹:</span>
                            <span class="alert-badge" id="expiredLicenseAlertCount">0</span>
                        </div>
                        <div class="alert-item">
                            <span>ØªØ±Ø§Ø®ÙŠØµ Ø¥Ø¹Ù„Ø§Ù† Ù…Ù†ØªÙ‡ÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹:</span>
                            <span class="alert-badge" id="expiredAdLicenseAlertCount">0</span>
                        </div>
                    </div>
                    <button class="btn btn-warning" id="viewAlertsBtn">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</button>
                </div>
                
                <div class="action-buttons">
                    <label for="importCarsFile" class="file-input-label">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Excel</label>
                    <input type="file" id="importCarsFile" class="file-input" accept=".xlsx, .xls">
                    <button class="btn btn-primary" id="exportTemplate">ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    <button class="btn btn-primary" id="addNewCar">Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                </div>
                
                <div class="search-box">
                    <input type="text" id="carSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©...">
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="sortByLicense">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ±Ø®ÙŠØµ</button>
                    <button class="btn btn-primary" id="sortByAdLicense">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
                    <button class="btn btn-primary" id="sortByMunicipalityLicense">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</button>
                    <button class="btn btn-secondary" id="printCarsTable">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
                    <button class="btn btn-secondary" id="exportCarsPDF">ØªØµØ¯ÙŠØ± PDF</button>
                    <button class="btn btn-secondary" id="exportCarsExcel">ØªØµØ¯ÙŠØ± Excel</button>
                </div>
                
                <table class="data-table" id="carsTable">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                            <th>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                            <th>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                            <th>Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¯ÙØªØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="no-export">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="carsTableBody"></tbody>
                </table>
            </section>

            <!-- Ù‚Ø³Ù… ØªØ³Ù„ÙŠÙ…/Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª -->
            <section id="delivery-receipt" class="content-section">
                <h2 class="section-title">ØªØ³Ù„ÙŠÙ…/Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h2>
                
                <div class="search-box">
                    <input type="text" id="deliverySearch" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚...">
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="showDeliveryForm">ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªÙ„Ø§Ù…/ØªØ³Ù„ÙŠÙ… Ø¬Ø¯ÙŠØ¯</button>
                    <button class="btn btn-primary" id="showReceiptForm">Ù†Ù…ÙˆØ°Ø¬ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</button>
                    <button class="btn btn-secondary" id="printDelivery">Ø·Ø¨Ø§Ø¹Ø©</button>
                    <button class="btn btn-secondary" id="exportDeliveryPDF">ØªØµØ¯ÙŠØ± PDF</button>
                    <button class="btn btn-secondary" id="exportDeliveryExcel">ØªØµØ¯ÙŠØ± Excel</button>
                </div>
                
                <div id="deliveryForm" style="display: none; margin-bottom: 20px;">
                    <h3>Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ù„ÙŠÙ…/Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h3>
                    <div class="compact-form">
                        <div class="form-container">
                            <div class="form-group">
                                <label for="carNumber">Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© *</label>
                                <input type="text" id="carNumber" placeholder="Ø§Ø¨Ø­Ø« ÙˆØ§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
                                <div class="error-message" id="carNumberError">ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø³ÙŠØ§Ø±Ø© Ù…Ø³Ø¬Ù„Ø©</div>
                                <div class="search-results" id="carSearchResults"></div>
                            </div>
                        </div>
                        <div class="form-container">
                            <div class="form-group">
                                <label for="restaurantName">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ *</label>
                                <input type="text" id="restaurantName" placeholder="Ø§Ø¨Ø­Ø« ÙˆØ§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹">
                                <div class="error-message" id="restaurantNameError">ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚Ø¹ Ù…Ø³Ø¬Ù„</div>
                                <div class="search-results" id="restaurantSearchResults"></div>
                            </div>
                        </div>
                        <div class="form-container">
                            <div class="form-group">
                                <label for="driverName">Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚ *</label>
                                <input type="text" id="driverName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚">
                            </div>
                        </div>
                        <div class="form-container">
                            <div class="form-group">
                                <label for="phoneNumber">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label>
                                <input type="text" id="phoneNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
                            </div>
                        </div>
                    </div>
                    <div class="compact-form-2">
                        <div class="form-group">
                            <label for="receiveDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</label>
                            <input type="date" id="receiveDate">
                        </div>
                        <div class="form-group">
                            <label for="deliveryDate">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</label>
                            <input type="date" id="deliveryDate">
                        </div>
                        <div class="form-group">
                            <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                            <textarea id="notes" rows="2" placeholder="Ø£Ø¯Ø®Ù„ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©"></textarea>
                        </div>
                    </div>
                    
                    <div class="car-sketch-container">
                        <h4>ØªØ­Ø¯ÙŠØ¯ Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø®Ø¯ÙˆØ´ Ø¨Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h4>
                        <div class="car-sketch" id="carSketch">
                            <div class="car-body"></div>
                            <div class="car-front"></div>
                            <div class="car-rear"></div>
                            <div class="car-window"></div>
                            <div class="car-wheel wheel-front"></div>
                            <div class="car-wheel wheel-rear"></div>
                            <div class="car-direction front-direction">Ø£Ù…Ø§Ù…</div>
                            <div class="car-direction rear-direction">Ø®Ù„Ù</div>
                        </div>
                        <div class="scratch-list" id="scratchList"></div>
                        <button type="button" class="btn btn-secondary" id="clearScratches">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø¯ÙˆØ´</button>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="saveDelivery">Ø­ÙØ¸</button>
                        <button class="btn btn-secondary" id="cancelDelivery">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
                
                <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ø¹ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ -->
                <div id="receiptForm" style="display: none; margin-bottom: 20px;">
                    <div class="receipt-container">
                        <div class="receipt-header">
                            <img id="receiptLogo" src="https://i.postimg.cc/NM2zJWZD/NAIF-LOGO.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©" class="receipt-logo">
                            <div class="receipt-header-text">
                                <h1 class="receipt-title">Ù†Ù…ÙˆØ°Ø¬ Ø§Ø³ØªÙ„Ø§Ù… Ø³ÙŠØ§Ø±Ø©</h1>
                                <div class="receipt-company">Ø´Ø±ÙƒØ© Ù†Ø§ÙŠÙ Ù„Ù„Ø£ØºØ°ÙŠØ©</div>
                            </div>
                        </div>
                        <div class="receipt-details">
                            <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</h3>
                            <table class="data-table receipt-table">
                                <tbody>
                                    <tr>
                                        <th>Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                                        <td id="receiptCarNumber">-</td>
                                        <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                                        <td id="receiptRestaurant">-</td>
                                    </tr>
                                    <tr>
                                        <th>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                                        <td id="receiptDriverName">-</td>
                                        <th>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</th>
                                        <td id="receiptPhoneNumber">-</td>
                                    </tr>
                                    <tr>
                                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</th>
                                        <td id="receiptReceiveDate">-</td>
                                        <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                        <td id="receiptNotes">-</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="car-sketch-container">
                            <h3>Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø®Ø¯ÙˆØ´ Ø¨Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h3>
                            <div class="car-sketch" id="receiptCarSketch">
                                <div class="car-body"></div>
                                <div class="car-front"></div>
                                <div class="car-rear"></div>
                                <div class="car-window"></div>
                                <div class="car-wheel wheel-front"></div>
                                <div class="car-wheel wheel-rear"></div>
                                <div class="car-direction front-direction">Ø£Ù…Ø§Ù…</div>
                                <div class="car-direction rear-direction">Ø®Ù„Ù</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <table class="data-table" id="deliveryTable">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th class="no-export">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="deliveryTableBody"></tbody>
                </table>
            </section>

            <!-- Ù‚Ø³Ù… ÙƒØ´Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
            <section id="car-history" class="content-section">
                <h2 class="section-title">ÙƒØ´Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h2>
                
                <div class="search-box">
                    <input type="text" id="carHistorySearch" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŒ Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚ØŒ Ø£Ùˆ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„...">
                    <div class="search-results" id="carHistorySearchResults"></div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="printHistory">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙƒØ´Ù</button>
                    <button class="btn btn-secondary" id="exportHistoryPDF">ØªØµØ¯ÙŠØ± PDF</button>
                    <button class="btn btn-secondary" id="exportHistoryExcel">ØªØµØ¯ÙŠØ± Excel</button>
                </div>
                
                <div id="carDetails"></div>
            </section>

            <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
            <section id="settings" class="content-section">
                <h2 class="section-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                
                <div class="action-buttons">
                    <label for="importRestaurantsFile" class="file-input-label">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙˆØ§Ù‚Ø¹ Ù…Ù† Excel</label>
                    <input type="file" id="importRestaurantsFile" class="file-input" accept=".xlsx, .xls">
                    <button class="btn btn-primary" id="addRestaurant">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯</button>
                </div>
                
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© (Ù…Ø¶Ø§ÙØ© Ø­Ø¯ÙŠØ«Ø§Ù‹) -->
                <div class="action-buttons" style="margin-top: 20px; margin-bottom: 20px;">
                    <button class="btn btn-primary" id="backupDataBtn">ğŸ“ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    <button class="btn btn-secondary" id="restoreDataBtn">ğŸ”„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                </div>
                
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                            <th class="no-export">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="restaurantsTableBody"></tbody>
                </table>
            </section>
        </div>
    </div>

    <!-- Ù‚Ø§Ù„Ø¨ PDF Ø§Ù„Ù…Ø®ÙÙŠ (Ù„ÙƒØ´Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©) -->
    <div id="pdf-template" class="pdf-template">
        <div class="pdf-header">
            <div class="pdf-header-row">
                <div style="text-align: center; margin-bottom: 10px;">
                    <img src="https://i.postimg.cc/NM2zJWZD/NAIF-LOGO.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©" class="pdf-logo">
                    <h2 class="pdf-title">Ø´Ø±ÙƒØ© Ù†Ø§ÙŠÙ Ù„Ù„Ø£ØºØ°ÙŠØ©</h2>
                </div>
                <h3 style="color: var(--primary-red); margin: 0 0 8px 0; font-size: 16px;">ÙƒØ´Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h3>
                <div style="margin-bottom: 8px; text-align: center;">
                    <div style="font-size: 14px; font-weight: bold; display: inline-block;">
                        Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©: <span id="pdf-car-number"></span>
                    </div>
                    <div style="display: inline-block; width: 1cm;"></div>
                    <div style="font-size: 12px; display: inline-block;">
                        ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: <span id="pdf-print-date"></span>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="pdf-car-info" style="margin-bottom: 10px; padding: 8px; background: #f8f9fa; border-radius: 4px; font-size: 11px; padding-left: 30px;"></div>
        
        <table class="statement-table" id="pdf-deliveries-table">
            <thead>
                <tr>
                    <th width="12%">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</th>
                    <th width="12%">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</th>
                    <th width="15%">Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                    <th width="12%">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</th>
                    <th width="15%">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                    <th width="34%">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="pdf-table-body"></tbody>
        </table>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø© -->
    <div id="carModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeCarModal">&times;</span>
            <h2>Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <div class="form-group">
                <label for="newCarNumber">Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© *</label>
                <input type="text" id="newCarNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
            </div>
            <div class="form-group">
                <label for="newCarType">Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© *</label>
                <input type="text" id="newCarType" placeholder="Ø£Ø¯Ø®Ù„ Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
            </div>
            <div class="form-group">
                <label for="newCarModel">Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© *</label>
                <input type="text" id="newCarModel" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
            </div>
            <div class="form-group">
                <label for="newCarYear">Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹ *</label>
                <input type="number" id="newCarYear" placeholder="Ø£Ø¯Ø®Ù„ Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹">
            </div>
            <div class="form-group">
                <label for="newLicenseExpiry">ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¯ÙØªØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© *</label>
                <input type="date" id="newLicenseExpiry">
            </div>
            <div class="form-group">
                <label for="newAdLicenseExpiry">ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                <input type="date" id="newAdLicenseExpiry">
            </div>
            <div class="form-group">
                <label for="newMunicipalityLicenseExpiry">ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</label>
                <input type="date" id="newMunicipalityLicenseExpiry">
            </div>
            <div class="form-group">
                <label for="newCarStatus">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                <select id="newCarStatus">
                    <option value="Ù†Ø´Ø·Ø©">Ù†Ø´Ø·Ø©</option>
                    <option value="ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©">ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
                    <option value="ØºÙŠØ± Ù†Ø´Ø·Ø©">ØºÙŠØ± Ù†Ø´Ø·Ø©</option>
                </select>
            </div>
            <div class="action-buttons">
                <button class="btn btn-primary" id="saveCar">Ø­ÙØ¸</button>
                <button class="btn btn-secondary" id="cancelCar">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ (Ø¨Ø¯ÙˆÙ† Ù†ÙˆØ¹ ÙˆØ¹Ù†ÙˆØ§Ù†) -->
    <div id="restaurantModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeRestaurantModal">&times;</span>
            <h2>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯</h2>
            <div class="form-group">
                <label for="newRestaurantName">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ *</label>
                <input type="text" id="newRestaurantName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹">
            </div>
            <div class="action-buttons">
                <button class="btn btn-primary" id="saveRestaurant">Ø­ÙØ¸</button>
                <button class="btn btn-secondary" id="cancelRestaurant">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        // ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ==========
        const initialCarsData = [
            { id: 1, number: '16/8826', type: 'ØªÙˆÙŠÙˆØªØ§', model: '1994', year: 1994, licenseExpiry: '2026-03-10', adLicenseExpiry: '2026-06-17', municipalityLicenseExpiry: '2026-03-10', status: 'Ù†Ø´Ø·Ø©' },
            { id: 2, number: '8/5056', type: 'ØªÙˆÙŠÙˆØªØ§', model: '1996', year: 1996, licenseExpiry: '2026-08-10', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 3, number: '8/84638', type: 'ØªÙˆÙŠÙˆØªØ§', model: '2003', year: 2003, licenseExpiry: '2026-11-12', adLicenseExpiry: '2026-04-16', municipalityLicenseExpiry: '2026-12-30', status: 'Ù†Ø´Ø·Ø©' },
            { id: 4, number: '3/37602', type: 'Ø¯Ø§ÙŠÙ‡Ø§ØªØ³Ùˆ', model: '2006', year: 2006, licenseExpiry: '2026-12-30', adLicenseExpiry: '2026-04-16', municipalityLicenseExpiry: '2026-12-08', status: 'Ù†Ø´Ø·Ø©' },
            { id: 5, number: '3/36017', type: 'Ø¯Ø§ÙŠÙ‡Ø§ØªØ³Ùˆ', model: '2008', year: 2008, licenseExpiry: '2026-04-04', adLicenseExpiry: '2026-04-16', municipalityLicenseExpiry: '2026-04-04', status: 'Ù†Ø´Ø·Ø©' },
            { id: 6, number: '2/28751', type: 'Ø¯Ø§ÙŠÙ‡Ø§ØªØ³Ùˆ', model: '2008', year: 2008, licenseExpiry: '2027-02-09', adLicenseExpiry: '2026-06-17', municipalityLicenseExpiry: '2027-02-15', status: 'Ù†Ø´Ø·Ø©' },
            { id: 7, number: '11/61043', type: 'Ø§ÙŠØ³ÙˆØ²Ùˆ', model: '2012', year: 2012, licenseExpiry: '2026-05-05', adLicenseExpiry: '2026-06-17', municipalityLicenseExpiry: '2026-05-04', status: 'Ù†Ø´Ø·Ø©' },
            { id: 8, number: '1/24469', type: 'Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´Ù‰', model: '2014', year: 2014, licenseExpiry: '2026-05-03', adLicenseExpiry: '2026-06-17', municipalityLicenseExpiry: '2026-05-03', status: 'Ù†Ø´Ø·Ø©' },
            { id: 9, number: '1/15817', type: 'Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´Ù‰', model: '2014', year: 2014, licenseExpiry: '2026-06-23', adLicenseExpiry: '2026-06-17', municipalityLicenseExpiry: '2026-05-27', status: 'Ù†Ø´Ø·Ø©' },
            { id: 10, number: '14/68978', type: 'Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´Ù‰', model: '2015', year: 2015, licenseExpiry: '2026-05-10', adLicenseExpiry: '2026-10-12', municipalityLicenseExpiry: '2026-05-04', status: 'Ù†Ø´Ø·Ø©' },
            { id: 11, number: '14/46106', type: 'Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´Ù‰', model: '2015', year: 2015, licenseExpiry: '2026-06-16', adLicenseExpiry: '2026-04-16', municipalityLicenseExpiry: '2026-05-27', status: 'Ù†Ø´Ø·Ø©' },
            { id: 12, number: '16/71355', type: 'ÙÙˆØ³Ùˆ', model: '2018', year: 2018, licenseExpiry: '2026-06-16', adLicenseExpiry: '2027-01-14', municipalityLicenseExpiry: '2026-05-27', status: 'Ù†Ø´Ø·Ø©' },
            { id: 13, number: '16/80272', type: 'ÙÙˆØ³Ùˆ', model: '2018', year: 2018, licenseExpiry: '2026-07-07', adLicenseExpiry: '2027-01-14', municipalityLicenseExpiry: '2026-07-07', status: 'Ù†Ø´Ø·Ø©' },
            { id: 14, number: '16/49198', type: 'Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´Ù‰', model: '2019', year: 2019, licenseExpiry: '2026-06-18', adLicenseExpiry: '2027-01-14', municipalityLicenseExpiry: '2026-05-27', status: 'Ù†Ø´Ø·Ø©' },
            { id: 15, number: '16/34236', type: 'Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´Ù‰', model: '2019', year: 2019, licenseExpiry: '2026-06-17', adLicenseExpiry: '2027-01-14', municipalityLicenseExpiry: '2026-06-03', status: 'Ù†Ø´Ø·Ø©' },
            { id: 16, number: '17/64559', type: 'ÙˆÙ†ÙŠØª ØªÙ„Ø§Ø¬Ø©', model: '2020', year: 2020, licenseExpiry: '2026-06-09', adLicenseExpiry: '2027-01-14', municipalityLicenseExpiry: '2026-06-03', status: 'Ù†Ø´Ø·Ø©' },
            { id: 17, number: '21/12673', type: 'Ø§ÙŠØ³ÙˆØ²Ùˆ', model: '2021', year: 2021, licenseExpiry: '2026-11-13', adLicenseExpiry: '2027-01-14', municipalityLicenseExpiry: '2026-11-13', status: 'Ù†Ø´Ø·Ø©' },
            { id: 18, number: '21/11172', type: 'Ø§ÙŠØ³ÙˆØ²Ùˆ', model: '2021', year: 2021, licenseExpiry: '2026-10-23', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 19, number: '22/38777', type: 'Ø§ÙŠØ³ÙˆØ²Ùˆ', model: '2023', year: 2023, licenseExpiry: '2026-12-24', adLicenseExpiry: '2026-10-12', municipalityLicenseExpiry: '2026-12-08', status: 'Ù†Ø´Ø·Ø©' },
            { id: 20, number: '22/38526', type: 'Ø§ÙŠØ³ÙˆØ²Ùˆ', model: '2023', year: 2023, licenseExpiry: '2026-12-24', adLicenseExpiry: '2026-10-12', municipalityLicenseExpiry: '2026-12-08', status: 'Ù†Ø´Ø·Ø©' },
            { id: 21, number: '22/67931', type: 'Ø§ÙŠØ³ÙˆØ²Ùˆ', model: '2024', year: 2024, licenseExpiry: '2026-07-01', adLicenseExpiry: '2026-10-12', municipalityLicenseExpiry: '2026-07-01', status: 'Ù†Ø´Ø·Ø©' },
            { id: 22, number: '22/67661', type: 'Ø§ÙŠØ³ÙˆØ²Ùˆ', model: '2024', year: 2024, licenseExpiry: '2026-07-01', adLicenseExpiry: '2026-10-12', municipalityLicenseExpiry: '2026-07-01', status: 'Ù†Ø´Ø·Ø©' },
            { id: 23, number: '11/41259', type: 'Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´Ù‰', model: '2012', year: 2012, licenseExpiry: '2026-03-25', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 24, number: '11/4789', type: 'ÙˆÙ†ÙŠØª', model: '1994', year: 1994, licenseExpiry: '2026-07-27', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 25, number: '15/76528', type: 'ÙˆÙ†ÙŠØª', model: '2016', year: 2016, licenseExpiry: '2026-08-20', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 26, number: '23/81493', type: 'ØªÙˆØªÙˆØªØ§ ÙƒÙˆØ³ØªØ±', model: '2025', year: 2025, licenseExpiry: '2028-01-20', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 27, number: '23/81149', type: 'ØªÙˆØªÙˆØªØ§ ÙƒÙˆØ³ØªØ±', model: '2025', year: 2025, licenseExpiry: '2028-01-20', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 28, number: '23/81274', type: 'ØªÙˆØªÙˆØªØ§ ÙƒÙˆØ³ØªØ±', model: '2025', year: 2025, licenseExpiry: '2028-01-20', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 29, number: '14/32580', type: 'Ø¯Ø§ÙŠÙ‡Ø§ØªØ³Ùˆ', model: '2016', year: 2016, licenseExpiry: '2026-10-12', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 30, number: '14/32981', type: 'Ø¯Ø§ÙŠÙ‡Ø§ØªØ³Ùˆ', model: '2016', year: 2016, licenseExpiry: '2026-10-12', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 31, number: '14/11023', type: 'Ø¯Ø§ÙŠÙ‡Ø§ØªØ³Ùˆ', model: '2016', year: 2016, licenseExpiry: '2026-10-15', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 32, number: '13/16479', type: 'Ø¯Ø§ÙŠÙ‡Ø§ØªØ³Ùˆ', model: '2016', year: 2016, licenseExpiry: '2026-11-29', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 33, number: '22/29845', type: 'ØªÙˆÙŠÙˆØªØ§', model: '2023', year: 2023, licenseExpiry: '2026-11-08', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' },
            { id: 34, number: '22/30275', type: 'ØªÙˆÙŠÙˆØªØ§', model: '2023', year: 2023, licenseExpiry: '2026-11-08', adLicenseExpiry: null, municipalityLicenseExpiry: null, status: 'Ù†Ø´Ø·Ø©' }
        ];

        // ========== Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø«Ø§Ø¨ØªØ© ==========
        const initialRestaurantsData = [
            { id: 1, name: 'Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø´ÙˆÙŠØ® Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©' },
            { id: 2, name: 'Ù…Ø®Ø§Ø²Ù† Ø§Ù…ØºØ±Ø©' },
            { id: 3, name: 'Ø§Ù„Ø§Ø¯Ø§Ø±Ø©' }
        ];

        // ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==========
        let carsData = JSON.parse(localStorage.getItem('carsData')) || initialCarsData;
        let deliveriesData = JSON.parse(localStorage.getItem('deliveriesData')) || [];
        let restaurantsData = JSON.parse(localStorage.getItem('restaurantsData')) || initialRestaurantsData;
        let currentSort = { field: 'licenseExpiry', order: 'asc' };
        let editingCarId = null;
        let editingDeliveryId = null;
        let editingRestaurantId = null;
        let scratches = [];

        // Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function saveAllData() {
            try {
                localStorage.setItem('carsData', JSON.stringify(carsData));
                localStorage.setItem('deliveriesData', JSON.stringify(deliveriesData));
                localStorage.setItem('restaurantsData', JSON.stringify(restaurantsData));
                console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupEventListeners();
            loadAllData();
            checkLicenseExpiry();
            initializeCarSketch();
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', switchTab);
            });
            
            document.getElementById('importCarsFile').addEventListener('change', function() {
                importFromExcel('cars', this.files[0]);
            });
            document.getElementById('exportTemplate').addEventListener('click', downloadTemplate);
            document.getElementById('addNewCar').addEventListener('click', showCarModal);
            document.getElementById('sortByLicense').addEventListener('click', () => sortCarsBy('licenseExpiry'));
            document.getElementById('sortByAdLicense').addEventListener('click', () => sortCarsBy('adLicenseExpiry'));
            document.getElementById('sortByMunicipalityLicense').addEventListener('click', () => sortCarsBy('municipalityLicenseExpiry'));
            
            document.getElementById('showDeliveryForm').addEventListener('click', showDeliveryForm);
            document.getElementById('showReceiptForm').addEventListener('click', showReceiptForm);
            document.getElementById('cancelDelivery').addEventListener('click', function() {
                hideDeliveryForm();
                resetDeliveryForm();
                alert('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©');
            });
            document.getElementById('saveDelivery').addEventListener('click', saveDelivery);
            document.getElementById('clearScratches').addEventListener('click', clearScratches);
            
            document.getElementById('carNumber').addEventListener('input', function() {
                searchCars(this.value);
            });
            document.getElementById('restaurantName').addEventListener('input', function() {
                searchRestaurants(this.value);
            });
            document.getElementById('carSearch').addEventListener('input', function() {
                filterTable('carsTable', this.value.toLowerCase());
            });
            document.getElementById('deliverySearch').addEventListener('input', function() {
                filterTable('deliveryTable', this.value.toLowerCase());
            });
            document.getElementById('carHistorySearch').addEventListener('input', function() {
                searchCarHistory(this.value);
            });
            
            document.getElementById('printCarsTable').addEventListener('click', () => 
                printTable('carsTable', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª'));
            document.getElementById('exportCarsPDF').addEventListener('click', () => 
                exportTableToPDF('carsTable', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª'));
            document.getElementById('exportCarsExcel').addEventListener('click', () => 
                exportTableToExcel(carsData, 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª'));
            
            document.getElementById('printDelivery').addEventListener('click', () => 
                printTable('deliveryTable', 'ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª'));
            document.getElementById('exportDeliveryPDF').addEventListener('click', () => 
                exportTableToPDF('deliveryTable', 'ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª'));
            document.getElementById('exportDeliveryExcel').addEventListener('click', () => 
                exportTableToExcel(deliveriesData, 'ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª'));
            
            document.getElementById('printHistory').addEventListener('click', printCarHistory);
            document.getElementById('exportHistoryPDF').addEventListener('click', exportCarHistoryPDF);
            document.getElementById('exportHistoryExcel').addEventListener('click', exportCarHistoryExcel);
            
            document.getElementById('monthlyReport').addEventListener('click', () => generateReport('monthly'));
            document.getElementById('yearlyReport').addEventListener('click', () => generateReport('yearly'));
            document.getElementById('expiryReport').addEventListener('click', () => generateReport('expiry'));
            document.getElementById('exportReport').addEventListener('click', () => 
                exportTableToExcel(generateReportData(), 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª'));
            
            document.getElementById('refreshAlerts').addEventListener('click', loadAlertsData);
            document.getElementById('exportAlerts').addEventListener('click', exportAlertsToExcel);
            
            document.getElementById('importRestaurantsFile').addEventListener('change', function() {
                importFromExcel('restaurants', this.files[0]);
            });
            document.getElementById('addRestaurant').addEventListener('click', showRestaurantModal);
            
            document.getElementById('closeCarModal').addEventListener('click', () => 
                document.getElementById('carModal').style.display = 'none');
            document.getElementById('closeRestaurantModal').addEventListener('click', () => 
                document.getElementById('restaurantModal').style.display = 'none');
            
            document.getElementById('saveCar').addEventListener('click', saveCar);
            document.getElementById('cancelCar').addEventListener('click', () => 
                document.getElementById('carModal').style.display = 'none');
            document.getElementById('saveRestaurant').addEventListener('click', saveRestaurant);
            document.getElementById('cancelRestaurant').addEventListener('click', () => 
                document.getElementById('restaurantModal').style.display = 'none');
            
            document.getElementById('viewAlertsBtn').addEventListener('click', function() {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
                
                const alertsTab = Array.from(document.querySelectorAll('.nav-tab')).find(tab => tab.getAttribute('data-target') === 'alerts');
                if (alertsTab) alertsTab.classList.add('active');
                document.getElementById('alerts').classList.add('active');
            });

            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });

            // ========== Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© (Ù…Ø¶Ø§ÙØ© Ø­Ø¯ÙŠØ«Ø§Ù‹) ==========
            document.getElementById('backupDataBtn').addEventListener('click', () => {
                const backupData = {
                    cars: carsData,
                    deliveries: deliveriesData,
                    restaurants: restaurantsData
                };
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ electronAPI (Ø¨ÙŠØ¦Ø© Electron)
                if (window.electronAPI) {
                    window.electronAPI.saveAutoBackup(JSON.stringify(backupData, null, 2));
                } else {
                    alert('ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ (ØªØ¹Ù…Ù„ ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚)');
                }
            });

            if (window.electronAPI) {
                window.electronAPI.onAutoBackupSaved((event, result) => {
                    if (result.success) {
                        alert(`âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ:\n${result.path}`);
                    } else {
                        alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®Ø©: ' + result.error);
                    }
                });

                document.getElementById('restoreDataBtn').addEventListener('click', () => {
                    window.electronAPI.loadAutoBackup();
                });

                window.electronAPI.onAutoBackupLoaded((event, result) => {
                    if (result.success) {
                        if (confirm('âš ï¸ Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                            try {
                                const data = JSON.parse(result.data);
                                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                                carsData = data.cars || [];
                                deliveriesData = data.deliveries || [];
                                restaurantsData = data.restaurants || [];
                                // Ø­ÙØ¸ ÙÙŠ localStorage
                                localStorage.setItem('carsData', JSON.stringify(carsData));
                                localStorage.setItem('deliveriesData', JSON.stringify(deliveriesData));
                                localStorage.setItem('restaurantsData', JSON.stringify(restaurantsData));
                                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
                                loadCarsData();
                                loadDeliveriesData();
                                loadRestaurantsData();
                                updateStats();
                                updateAlertsBar();
                                checkLicenseExpiry();
                                alert('âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                            } catch (e) {
                                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + e.message);
                            }
                        }
                    } else {
                        alert('âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø©: ' + result.error);
                    }
                });
            } else {
                // ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ electronAPI (Ù…Ø«Ù„Ø§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­)
                document.getElementById('restoreDataBtn').addEventListener('click', () => {
                    alert('ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ (ØªØ¹Ù…Ù„ ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚)');
                });
            }
        }

        function switchTab() {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            
            this.classList.add('active');
            const targetId = this.getAttribute('data-target');
            document.getElementById(targetId).classList.add('active');
            
            if (targetId === 'alerts') loadAlertsData();
        }

        function loadAllData() {
            loadCarsData();
            loadDeliveriesData();
            loadRestaurantsData();
            updateStats();
            updateAlertsBar();
        }

        function loadCarsData() {
            const tbody = document.getElementById('carsTableBody');
            tbody.innerHTML = '';
            
            if (carsData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="9" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª Ù…Ø³Ø¬Ù„Ø©</td>`;
                tbody.appendChild(row);
                return;
            }
            
            carsData.forEach(car => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${car.number}</td>
                    <td>${car.type}</td>
                    <td>${car.model}</td>
                    <td>${car.year}</td>
                    <td>${car.licenseExpiry}</td>
                    <td>${car.adLicenseExpiry || '-'}</td>
                    <td>${car.municipalityLicenseExpiry || '-'}</td>
                    <td>${car.status}</td>
                    <td class="no-export">
                        <button class="btn btn-warning edit-car" data-id="${car.id}">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-danger delete-car" data-id="${car.id}">Ø­Ø°Ù</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            document.querySelectorAll('.edit-car').forEach(btn => {
                btn.addEventListener('click', function() {
                    editCar(parseInt(this.getAttribute('data-id')));
                });
            });

            document.querySelectorAll('.delete-car').forEach(btn => {
                btn.addEventListener('click', function() {
                    deleteCar(parseInt(this.getAttribute('data-id')));
                });
            });
        }

        function loadDeliveriesData() {
            const tbody = document.getElementById('deliveryTableBody');
            tbody.innerHTML = '';
            
            if (deliveriesData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="8" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª ØªØ³Ù„ÙŠÙ… Ù…Ø³Ø¬Ù„Ø©</td>`;
                tbody.appendChild(row);
                return;
            }
            
            deliveriesData.forEach(delivery => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${delivery.carNumber}</td>
                    <td>${delivery.driverName}</td>
                    <td>${delivery.phoneNumber}</td>
                    <td>${delivery.restaurant}</td>
                    <td>${delivery.receiveDate}</td>
                    <td>${delivery.deliveryDate || '-'}</td>
                    <td>${delivery.notes}</td>
                    <td class="no-export">
                        <button class="btn btn-warning edit-delivery" data-id="${delivery.id}">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-info print-receipt" data-id="${delivery.id}">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
                        ${!delivery.deliveryDate ? `<button class="btn btn-primary complete-delivery" data-id="${delivery.id}">Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>` : ''}
                        <button class="btn btn-danger delete-delivery" data-id="${delivery.id}">Ø­Ø°Ù</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            document.querySelectorAll('.edit-delivery').forEach(btn => {
                btn.addEventListener('click', function() {
                    editDelivery(parseInt(this.getAttribute('data-id')));
                });
            });

            document.querySelectorAll('.print-receipt').forEach(btn => {
                btn.addEventListener('click', function() {
                    printDeliveryReceipt(parseInt(this.getAttribute('data-id')));
                });
            });

            document.querySelectorAll('.complete-delivery').forEach(btn => {
                btn.addEventListener('click', function() {
                    completeDelivery(parseInt(this.getAttribute('data-id')));
                });
            });

            document.querySelectorAll('.delete-delivery').forEach(btn => {
                btn.addEventListener('click', function() {
                    deleteDelivery(parseInt(this.getAttribute('data-id')));
                });
            });
        }

        function loadRestaurantsData() {
            const tbody = document.getElementById('restaurantsTableBody');
            tbody.innerHTML = '';
            
            if (restaurantsData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="2" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ù‚Ø¹ Ù…Ø³Ø¬Ù„Ø©</td>`;
                tbody.appendChild(row);
                return;
            }
            
            restaurantsData.forEach(restaurant => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${restaurant.name}</td>
                    <td class="no-export">
                        <button class="btn btn-warning edit-restaurant" data-id="${restaurant.id}">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-danger delete-restaurant" data-id="${restaurant.id}">Ø­Ø°Ù</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            document.querySelectorAll('.edit-restaurant').forEach(btn => {
                btn.addEventListener('click', function() {
                    editRestaurant(parseInt(this.getAttribute('data-id')));
                });
            });

            document.querySelectorAll('.delete-restaurant').forEach(btn => {
                btn.addEventListener('click', function() {
                    deleteRestaurant(parseInt(this.getAttribute('data-id')));
                });
            });
        }

        function updateStats() {
            const totalCars = carsData.length;
            const activeCars = carsData.filter(car => car.status === 'Ù†Ø´Ø·Ø©').length;
            const maintenanceCars = carsData.filter(car => car.status === 'ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©').length;
            const totalRestaurants = restaurantsData.length;
            
            const today = new Date();
            const nextMonth = new Date();
            nextMonth.setDate(today.getDate() + 30);
            
            const expiringLicenses = carsData.filter(car => {
                const expiryDate = new Date(car.licenseExpiry);
                return expiryDate >= today && expiryDate <= nextMonth;
            }).length;

            const expiringAdLicenses = carsData.filter(car => {
                if (!car.adLicenseExpiry) return false;
                const expiryDate = new Date(car.adLicenseExpiry);
                return expiryDate >= today && expiryDate <= nextMonth;
            }).length;
            
            const activeDeliveries = deliveriesData.filter(d => !d.deliveryDate).length;
            
            document.getElementById('totalCarsCount').textContent = totalCars;
            document.getElementById('activeCarsCount').textContent = activeCars;
            document.getElementById('maintenanceCarsCount').textContent = maintenanceCars;
            document.getElementById('expiringLicensesCount').textContent = expiringLicenses;
            document.getElementById('expiringAdLicensesCount').textContent = expiringAdLicenses;
            document.getElementById('activeDeliveriesCount').textContent = activeDeliveries;
            document.getElementById('totalRestaurantsCount').textContent = totalRestaurants;
        }

        function updateAlertsBar() {
            const today = new Date();
            const nextMonth = new Date();
            nextMonth.setDate(today.getDate() + 30);
            
            const expiringLicenses = carsData.filter(car => {
                const expiryDate = new Date(car.licenseExpiry);
                return expiryDate >= today && expiryDate <= nextMonth;
            }).length;

            const expiringAdLicenses = carsData.filter(car => {
                if (!car.adLicenseExpiry) return false;
                const expiryDate = new Date(car.adLicenseExpiry);
                return expiryDate >= today && expiryDate <= nextMonth;
            }).length;
            
            const expiredLicenses = carsData.filter(car => {
                const expiryDate = new Date(car.licenseExpiry);
                return expiryDate < today;
            }).length;

            const expiredAdLicenses = carsData.filter(car => {
                if (!car.adLicenseExpiry) return false;
                const expiryDate = new Date(car.adLicenseExpiry);
                return expiryDate < today;
            }).length;
            
            const alertsBar = document.getElementById('alertsBar');
            const licenseAlertCount = document.getElementById('licenseAlertCount');
            const adLicenseAlertCount = document.getElementById('adLicenseAlertCount');
            const expiredLicenseAlertCount = document.getElementById('expiredLicenseAlertCount');
            const expiredAdLicenseAlertCount = document.getElementById('expiredAdLicenseAlertCount');
            
            if (expiringLicenses > 0 || expiringAdLicenses > 0 || expiredLicenses > 0 || expiredAdLicenses > 0) {
                alertsBar.style.display = 'flex';
                licenseAlertCount.textContent = expiringLicenses;
                adLicenseAlertCount.textContent = expiringAdLicenses;
                expiredLicenseAlertCount.textContent = expiredLicenses;
                expiredAdLicenseAlertCount.textContent = expiredAdLicenses;
            } else {
                alertsBar.style.display = 'none';
            }
        }

        function checkLicenseExpiry() {
            const today = new Date();
            const nextMonth = new Date();
            nextMonth.setDate(today.getDate() + 30);
            
            const expiringCars = carsData.filter(car => {
                const expiryDate = new Date(car.licenseExpiry);
                return expiryDate >= today && expiryDate <= nextMonth;
            });
            
            const alertElement = document.getElementById('licenseAlert');
            const alertMessage = document.getElementById('alertMessage');
            
            if (expiringCars.length > 0) {
                const carNumbers = expiringCars.map(car => car.number).join(', ');
                alertMessage.textContent = `Ù‡Ù†Ø§Ùƒ ${expiringCars.length} Ø³ÙŠØ§Ø±Ø§Øª Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ±Ø®ÙŠØµ Ø®Ù„Ø§Ù„ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…: ${carNumbers}`;
                alertElement.style.display = 'block';
            } else {
                alertElement.style.display = 'none';
            }
        }

        function showDeliveryForm() {
            resetDeliveryForm();
            document.getElementById('deliveryForm').style.display = 'block';
            document.getElementById('receiptForm').style.display = 'none';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('receiveDate').value = today;
            editingDeliveryId = null;
        }

        function showReceiptForm() {
            document.getElementById('receiptForm').style.display = 'block';
            document.getElementById('deliveryForm').style.display = 'none';
            
            document.getElementById('receiptCarNumber').textContent = '';
            document.getElementById('receiptRestaurant').textContent = '';
            document.getElementById('receiptDriverName').textContent = '';
            document.getElementById('receiptPhoneNumber').textContent = '';
            document.getElementById('receiptReceiveDate').textContent = '';
            document.getElementById('receiptNotes').textContent = '';
            
            const receiptCarSketch = document.getElementById('receiptCarSketch');
            const oldScratches = receiptCarSketch.querySelectorAll('.scratch-point');
            oldScratches.forEach(scratch => scratch.remove());
        }

        function hideDeliveryForm() {
            document.getElementById('deliveryForm').style.display = 'none';
            document.getElementById('receiptForm').style.display = 'none';
            
            const carSearchResults = document.getElementById('carSearchResults');
            const restaurantSearchResults = document.getElementById('restaurantSearchResults');
            if (carSearchResults) carSearchResults.style.display = 'none';
            if (restaurantSearchResults) restaurantSearchResults.style.display = 'none';
            
            const carNumberError = document.getElementById('carNumberError');
            const restaurantNameError = document.getElementById('restaurantNameError');
            if (carNumberError) carNumberError.style.display = 'none';
            if (restaurantNameError) restaurantNameError.style.display = 'none';
            
            editingDeliveryId = null;
            scratches = [];
            updateScratchesList();
        }

        function resetDeliveryForm() {
            const fields = ['carNumber', 'restaurantName', 'driverName', 'phoneNumber', 'receiveDate', 'deliveryDate', 'notes'];
            
            fields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    if (element.type === 'date') {
                        if (fieldId === 'receiveDate') {
                            element.valueAsDate = new Date();
                        } else {
                            element.value = '';
                        }
                    } else {
                        element.value = '';
                    }
                }
            });
            
            scratches = [];
            updateScratchesList();
            document.getElementById('carNumberError').style.display = 'none';
            document.getElementById('restaurantNameError').style.display = 'none';
            document.getElementById('carSearchResults').style.display = 'none';
            document.getElementById('restaurantSearchResults').style.display = 'none';
        }

        function saveDelivery() {
            const carNumber = document.getElementById('carNumber').value.trim();
            const restaurantName = document.getElementById('restaurantName').value.trim();
            const driverName = document.getElementById('driverName').value.trim();
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            const receiveDate = document.getElementById('receiveDate').value;
            const deliveryDate = document.getElementById('deliveryDate').value;
            const notes = document.getElementById('notes').value;
            
            if (!carNumber || !restaurantName || !driverName) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ© (Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŒ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚)');
                return;
            }
            
            const car = carsData.find(c => c.number === carNumber);
            if (!car) {
                document.getElementById('carNumberError').style.display = 'block';
                alert('Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØºÙŠØ± Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…');
                return;
            }
            document.getElementById('carNumberError').style.display = 'none';
            
            if (car.status !== 'Ù†Ø´Ø·Ø©') {
                let statusMessage = car.status === 'ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©' ? 'ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©' : 'ØºÙŠØ± Ù†Ø´Ø·Ø©';
                alert(`Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø³ÙŠØ§Ø±Ø© ${carNumber} Ù„Ø£Ù†Ù‡Ø§ ${statusMessage}`);
                return;
            }
            
            const restaurantExists = restaurantsData.some(restaurant => restaurant.name === restaurantName);
            if (!restaurantExists) {
                document.getElementById('restaurantNameError').style.display = 'block';
                alert('Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…');
                return;
            }
            document.getElementById('restaurantNameError').style.display = 'none';
            
            if (!editingDeliveryId) {
                const activeDelivery = deliveriesData.find(d => d.carNumber === carNumber && !d.deliveryDate);
                if (activeDelivery) {
                    alert(`Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø³ÙŠØ§Ø±Ø© ${carNumber} Ù„Ø£Ù†Ù‡Ø§ Ù…Ø³Ù„Ù…Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ù„Ø³Ø§Ø¦Ù‚ ${activeDelivery.driverName}`);
                    return;
                }
            }
            
            const deliveryData = {
                carNumber: carNumber,
                driverName: driverName,
                phoneNumber: phoneNumber,
                restaurant: restaurantName,
                receiveDate: receiveDate || new Date().toISOString().split('T')[0],
                deliveryDate: deliveryDate,
                notes: notes,
                scratches: [...scratches]
            };
            
            if (editingDeliveryId) {
                const deliveryIndex = deliveriesData.findIndex(d => d.id === editingDeliveryId);
                if (deliveryIndex !== -1) {
                    deliveriesData[deliveryIndex] = {
                        ...deliveriesData[deliveryIndex],
                        ...deliveryData
                    };
                } else {
                    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù„Ù„ØªØ¹Ø¯ÙŠÙ„');
                    return;
                }
            } else {
                const newDelivery = {
                    id: deliveriesData.length > 0 ? Math.max(...deliveriesData.map(d => d.id)) + 1 : 1,
                    ...deliveryData
                };
                
                deliveriesData.push(newDelivery);
            }
            
            saveAllData();
            loadDeliveriesData();
            updateStats();
            hideDeliveryForm();
            alert('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­');
        }

        function printDeliveryReceipt(deliveryId) {
            const delivery = deliveriesData.find(d => d.id === deliveryId);
            if (!delivery) {
                alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…');
                return;
            }
            
            const receiptHTML = `
                <div class="receipt-container">
                    <div class="receipt-header">
                        <img src="https://i.postimg.cc/NM2zJWZD/NAIF-LOGO.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©" class="receipt-logo">
                        <h1 class="receipt-title">Ù†Ù…ÙˆØ°Ø¬ Ø§Ø³ØªÙ„Ø§Ù… Ø³ÙŠØ§Ø±Ø©</h1>
                        <div class="receipt-company">Ø´Ø±ÙƒØ© Ù†Ø§ÙŠÙ Ù„Ù„Ø£ØºØ°ÙŠØ©</div>
                    </div>
                    
                    <div class="receipt-details">
                        <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</h3>
                        <table class="data-table">
                            <tbody>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                                    <td>${delivery.carNumber}</td>
                                </tr>
                                <tr>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                                    <td>${delivery.restaurant}</td>
                                </tr>
                                <tr>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                                    <td>${delivery.driverName}</td>
                                </tr>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</th>
                                    <td>${delivery.phoneNumber}</td>
                                </tr>
                                <tr>
                                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</th>
                                    <td>${delivery.receiveDate}</td>
                                </tr>
                                <tr>
                                    <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                    <td>${delivery.notes}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="car-sketch-container">
                        <h3>Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø®Ø¯ÙˆØ´ Ø¨Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h3>
                        <div class="car-sketch" id="receiptCarSketch">
                            <div class="car-body"></div>
                            <div class="car-front"></div>
                            <div class="car-rear"></div>
                            <div class="car-window"></div>
                            <div class="car-wheel wheel-front"></div>
                            <div class="car-wheel wheel-rear"></div>
                            <div class="car-direction front-direction">Ø£Ù…Ø§Ù…</div>
                            <div class="car-direction rear-direction">Ø®Ù„Ù</div>
                        </div>
                    </div>
                    
                    <div class="signature-container">
                        <h3>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¨Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h3>
                        <div class="signature-box"></div>
                    </div>
                </div>
            `;
            
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = receiptHTML;
            
            if (delivery.scratches && delivery.scratches.length > 0) {
                const receiptCarSketch = tempDiv.querySelector('#receiptCarSketch');
                delivery.scratches.forEach(scratch => {
                    const scratchPoint = document.createElement('div');
                    scratchPoint.className = 'scratch-point';
                    scratchPoint.style.left = `${scratch.x - 5}px`;
                    scratchPoint.style.top = `${scratch.y - 5}px`;
                    receiptCarSketch.appendChild(scratchPoint);
                });
            }
            
            const opt = {
                margin: 10,
                filename: `Ù†Ù…ÙˆØ°Ø¬_Ø§Ø³ØªÙ„Ø§Ù…_${delivery.carNumber}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(tempDiv).save();
        }

        function editDelivery(id) {
            const delivery = deliveriesData.find(d => d.id === id);
            if (delivery) {
                editingDeliveryId = id;
                document.getElementById('carNumber').value = delivery.carNumber;
                document.getElementById('driverName').value = delivery.driverName;
                document.getElementById('phoneNumber').value = delivery.phoneNumber;
                document.getElementById('restaurantName').value = delivery.restaurant;
                document.getElementById('receiveDate').value = delivery.receiveDate;
                document.getElementById('deliveryDate').value = delivery.deliveryDate || '';
                document.getElementById('notes').value = delivery.notes;
                
                if (delivery.scratches) {
                    scratches = [...delivery.scratches];
                    updateScratchesList();
                    renderScratches();
                }
                
                document.getElementById('deliveryForm').style.display = 'block';
            }
        }

        function completeDelivery(id) {
            const delivery = deliveriesData.find(d => d.id === id);
            if (delivery) {
                delivery.deliveryDate = new Date().toISOString().split('T')[0];
                saveAllData();
                loadDeliveriesData();
                updateStats();
                alert('ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        function deleteDelivery(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ³Ù„ÙŠÙ…ØŸ')) {
                deliveriesData = deliveriesData.filter(d => d.id !== id);
                saveAllData();
                loadDeliveriesData();
                updateStats();
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        function showCarModal() {
            editingCarId = null;
            document.getElementById('carModal').style.display = 'block';
            document.getElementById('carModal').querySelector('h2').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©';
            document.getElementById('newCarNumber').value = '';
            document.getElementById('newCarType').value = '';
            document.getElementById('newCarModel').value = '';
            document.getElementById('newCarYear').value = '';
            document.getElementById('newLicenseExpiry').value = new Date().toISOString().split('T')[0];
            document.getElementById('newAdLicenseExpiry').value = '';
            document.getElementById('newMunicipalityLicenseExpiry').value = '';
            document.getElementById('newCarStatus').value = 'Ù†Ø´Ø·Ø©';
        }

        function saveCar() {
            const number = document.getElementById('newCarNumber').value.trim();
            const type = document.getElementById('newCarType').value.trim();
            const model = document.getElementById('newCarModel').value.trim();
            const year = document.getElementById('newCarYear').value;
            const licenseExpiry = document.getElementById('newLicenseExpiry').value;
            const adLicenseExpiry = document.getElementById('newAdLicenseExpiry').value;
            const municipalityLicenseExpiry = document.getElementById('newMunicipalityLicenseExpiry').value;
            const status = document.getElementById('newCarStatus').value;
            
            if (!number || !type || !model || !year || !licenseExpiry) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ©');
                return;
            }
            
            const currentYear = new Date().getFullYear();
            if (year < 1900 || year > currentYear + 1) {
                alert('Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹ ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                return;
            }
            
            if (!isValidDate(licenseExpiry)) {
                alert('ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¯ÙØªØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØºÙŠØ± ØµØ­ÙŠØ­');
                return;
            }
            
            if (adLicenseExpiry && !isValidDate(adLicenseExpiry)) {
                alert('ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± ØµØ­ÙŠØ­');
                return;
            }
            
            if (municipalityLicenseExpiry && !isValidDate(municipalityLicenseExpiry)) {
                alert('ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­');
                return;
            }
            
            if (editingCarId) {
                const existingCar = carsData.find(c => c.number === number && c.id !== editingCarId);
                if (existingCar) {
                    alert(`Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© ${number} Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø¨Ù„ Ø³ÙŠØ§Ø±Ø© Ø£Ø®Ø±Ù‰`);
                    return;
                }
            } else {
                const existingCar = carsData.find(c => c.number === number);
                if (existingCar) {
                    alert(`Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© ${number} Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…`);
                    return;
                }
            }
            
            if (editingCarId) {
                const carIndex = carsData.findIndex(c => c.id === editingCarId);
                if (carIndex !== -1) {
                    carsData[carIndex] = {
                        ...carsData[carIndex],
                        number: number,
                        type: type,
                        model: model,
                        year: parseInt(year),
                        licenseExpiry: licenseExpiry,
                        adLicenseExpiry: adLicenseExpiry || null,
                        municipalityLicenseExpiry: municipalityLicenseExpiry || null,
                        status: status
                    };
                } else {
                    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„');
                    return;
                }
            } else {
                const newCar = {
                    id: carsData.length > 0 ? Math.max(...carsData.map(c => c.id)) + 1 : 1,
                    number: number,
                    type: type,
                    model: model,
                    year: parseInt(year),
                    licenseExpiry: licenseExpiry,
                    adLicenseExpiry: adLicenseExpiry || null,
                    municipalityLicenseExpiry: municipalityLicenseExpiry || null,
                    status: status
                };
                
                carsData.push(newCar);
            }
            
            saveAllData();
            loadCarsData();
            updateStats();
            updateAlertsBar();
            checkLicenseExpiry();
            document.getElementById('carModal').style.display = 'none';
            alert('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }

        function isValidDate(dateString) {
            const regex = /^\d{4}-\d{2}-\d{2}$/;
            if (!dateString.match(regex)) return false;
            
            const date = new Date(dateString);
            const timestamp = date.getTime();
            
            if (typeof timestamp !== 'number' || Number.isNaN(timestamp)) {
                return false;
            }
            
            return date.toISOString().split('T')[0] === dateString;
        }

        function editCar(id) {
            const car = carsData.find(c => c.id === id);
            if (car) {
                editingCarId = id;
                document.getElementById('carModal').style.display = 'block';
                document.getElementById('carModal').querySelector('h2').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©';
                document.getElementById('newCarNumber').value = car.number;
                document.getElementById('newCarType').value = car.type;
                document.getElementById('newCarModel').value = car.model;
                document.getElementById('newCarYear').value = car.year;
                document.getElementById('newLicenseExpiry').value = car.licenseExpiry;
                document.getElementById('newAdLicenseExpiry').value = car.adLicenseExpiry || '';
                document.getElementById('newMunicipalityLicenseExpiry').value = car.municipalityLicenseExpiry || '';
                document.getElementById('newCarStatus').value = car.status;
            }
        }

        function deleteCar(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŸ')) {
                carsData = carsData.filter(c => c.id !== id);
                saveAllData();
                loadCarsData();
                updateStats();
                updateAlertsBar();
                checkLicenseExpiry();
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        function showRestaurantModal() {
            editingRestaurantId = null;
            document.getElementById('restaurantModal').style.display = 'block';
            document.getElementById('restaurantModal').querySelector('h2').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯';
            document.getElementById('newRestaurantName').value = '';
        }

        function saveRestaurant() {
            const name = document.getElementById('newRestaurantName').value;

            if (!name) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹');
                return;
            }
            
            if (editingRestaurantId) {
                const restaurantIndex = restaurantsData.findIndex(r => r.id === editingRestaurantId);
                if (restaurantIndex !== -1) {
                    restaurantsData[restaurantIndex] = {
                        ...restaurantsData[restaurantIndex],
                        name: name
                    };
                }
            } else {
                const newRestaurant = {
                    id: restaurantsData.length > 0 ? Math.max(...restaurantsData.map(r => r.id)) + 1 : 1,
                    name: name
                };
                
                restaurantsData.push(newRestaurant);
            }
            
            saveAllData();
            loadRestaurantsData();
            updateStats();
            document.getElementById('restaurantModal').style.display = 'none';
            alert('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­');
        }

        function editRestaurant(id) {
            const restaurant = restaurantsData.find(r => r.id === id);
            if (restaurant) {
                editingRestaurantId = id;
                document.getElementById('restaurantModal').style.display = 'block';
                document.getElementById('restaurantModal').querySelector('h2').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹';
                document.getElementById('newRestaurantName').value = restaurant.name;
            }
        }

        function deleteRestaurant(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŸ')) {
                restaurantsData = restaurantsData.filter(r => r.id !== id);
                saveAllData();
                loadRestaurantsData();
                updateStats();
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        function initializeCarSketch() {
            const carSketch = document.getElementById('carSketch');
            if (carSketch) {
                carSketch.addEventListener('click', function(e) {
                    const rect = this.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    let location = '';
                    if (x < rect.width * 0.2) {
                        location = 'Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø§Ù„ÙŠØ³Ø±Ù‰';
                    } else if (x < rect.width * 0.4) {
                        location = 'Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©';
                    } else if (x < rect.width * 0.6) {
                        location = 'Ø§Ù„ÙˆØ³Ø·';
                    } else if (x < rect.width * 0.8) {
                        location = 'Ø§Ù„Ø®Ù„Ù';
                    } else {
                        location = 'Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰';
                    }
                    
                    addScratch(x, y, location);
                });
            }
        }

        function addScratch(x, y, location) {
            const scratch = {
                id: scratches.length + 1,
                x: x,
                y: y,
                location: location
            };
            
            scratches.push(scratch);
            updateScratchesList();
            renderScratches();
        }

        function updateScratchesList() {
            const scratchList = document.getElementById('scratchList');
            scratchList.innerHTML = '';
            
            if (scratches.length === 0) {
                scratchList.innerHTML = `<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø¯ÙˆØ´ Ù…Ø³Ø¬Ù„Ø©</p>`;
                return;
            }
            
            scratches.forEach(scratch => {
                const scratchItem = document.createElement('div');
                scratchItem.className = 'scratch-item';
                scratchItem.innerHTML = `
                    <span class="scratch-location">${scratch.location}</span>
                    <button class="remove-scratch" data-id="${scratch.id}">Ø­Ø°Ù</button>
                `;
                scratchList.appendChild(scratchItem);
            });
            
            document.querySelectorAll('.remove-scratch').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    removeScratch(id);
                });
            });
        }

        function renderScratches() {
            const carSketch = document.getElementById('carSketch');
            const oldScratches = carSketch.querySelectorAll('.scratch-point');
            oldScratches.forEach(scratch => scratch.remove());
            
            scratches.forEach(scratch => {
                const scratchPoint = document.createElement('div');
                scratchPoint.className = 'scratch-point';
                scratchPoint.style.left = `${scratch.x - 5}px`;
                scratchPoint.style.top = `${scratch.y - 5}px`;
                scratchPoint.setAttribute('data-id', scratch.id);
                carSketch.appendChild(scratchPoint);
            });
        }

        function removeScratch(id) {
            scratches = scratches.filter(scratch => scratch.id !== id);
            updateScratchesList();
            renderScratches();
        }

        function clearScratches() {
            scratches = [];
            updateScratchesList();
            renderScratches();
        }

        function searchCars(query) {
            const resultsContainer = document.getElementById('carSearchResults');
            resultsContainer.innerHTML = '';
            
            if (query.length < 1) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            const filteredCars = carsData.filter(car => 
                car.number.toLowerCase().includes(query.toLowerCase())
            );
            
            if (filteredCars.length > 0) {
                filteredCars.forEach(car => {
                    const item = document.createElement('div');
                    item.className = 'search-result-item';
                    item.textContent = car.number;
                    item.addEventListener('click', function() {
                        document.getElementById('carNumber').value = car.number;
                        resultsContainer.style.display = 'none';
                        document.getElementById('carNumberError').style.display = 'none';
                    });
                    resultsContainer.appendChild(item);
                });
                resultsContainer.style.display = 'block';
            } else {
                resultsContainer.style.display = 'none';
            }
        }

        function searchCarHistory(query) {
            const resultsContainer = document.getElementById('carHistorySearchResults');
            resultsContainer.innerHTML = '';
            
            if (query.length < 1) {
                resultsContainer.style.display = 'none';
                const carDetails = document.getElementById('carDetails');
                carDetails.innerHTML = '';
                return;
            }
            
            const filteredCars = carsData.filter(car => 
                car.number.toLowerCase().includes(query.toLowerCase()) ||
                car.type.toLowerCase().includes(query.toLowerCase()) ||
                car.model.toLowerCase().includes(query.toLowerCase())
            );
            
            if (filteredCars.length > 0) {
                filteredCars.forEach(car => {
                    const item = document.createElement('div');
                    item.className = 'search-result-item';
                    item.textContent = `${car.number} - ${car.type} - ${car.model}`;
                    item.addEventListener('click', function() {
                        document.getElementById('carHistorySearch').value = car.number;
                        resultsContainer.style.display = 'none';
                        displayCarDetails(car);
                    });
                    resultsContainer.appendChild(item);
                });
                resultsContainer.style.display = 'block';
            } else {
                resultsContainer.style.display = 'none';
                const carDetails = document.getElementById('carDetails');
                carDetails.innerHTML = `<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø© ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>`;
            }
        }

        function displayCarDetails(car) {
            const carDeliveries = deliveriesData.filter(d => d.carNumber === car.number);
            
            let deliveriesHtml = '';
            if (carDeliveries.length > 0) {
                deliveriesHtml = `
                    <h4>Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</th>
                                <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${carDeliveries.map(d => `
                                <tr>
                                    <td>${d.driverName}</td>
                                    <td>${d.phoneNumber}</td>
                                    <td>${d.restaurant}</td>
                                    <td>${d.receiveDate}</td>
                                    <td>${d.deliveryDate || '-'}</td>
                                    <td>${d.notes}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                deliveriesHtml = `<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</p>`;
            }
            
            const carDetails = document.getElementById('carDetails');
            carDetails.innerHTML = `
                <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${car.number}</h3>
                <div class="car-info">
                    <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</strong> ${car.type}</p>
                    <p><strong>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</strong> ${car.model}</p>
                    <p><strong>Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹:</strong> ${car.year}</p>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</strong> ${car.licenseExpiry}</p>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:</strong> ${car.adLicenseExpiry || '-'}</p>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©:</strong> ${car.municipalityLicenseExpiry || '-'}</p>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${car.status}</p>
                </div>
                ${deliveriesHtml}
            `;
        }

        function searchRestaurants(query) {
            const resultsContainer = document.getElementById('restaurantSearchResults');
            resultsContainer.innerHTML = '';
            
            if (query.length < 1) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            const filteredRestaurants = restaurantsData.filter(restaurant => 
                restaurant.name.toLowerCase().includes(query.toLowerCase())
            );
            
            if (filteredRestaurants.length > 0) {
                filteredRestaurants.forEach(restaurant => {
                    const item = document.createElement('div');
                    item.className = 'search-result-item';
                    item.textContent = restaurant.name;
                    item.addEventListener('click', function() {
                        document.getElementById('restaurantName').value = restaurant.name;
                        resultsContainer.style.display = 'none';
                        document.getElementById('restaurantNameError').style.display = 'none';
                    });
                    resultsContainer.appendChild(item);
                });
                resultsContainer.style.display = 'block';
            } else {
                resultsContainer.style.display = 'none';
            }
        }

        function filterTable(tableId, query) {
            const table = document.getElementById(tableId);
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent.toLowerCase();
                    if (cellText.includes(query)) {
                        found = true;
                        break;
                    }
                }
                
                rows[i].style.display = found ? '' : 'none';
            }
        }

        function sortCarsBy(field) {
            const isSameField = currentSort.field === field;
            
            if (isSameField) {
                currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.order = 'asc';
            }
            
            carsData.sort((a, b) => {
                let aValue = a[field];
                let bValue = b[field];
                
                if (field.includes('Expiry')) {
                    aValue = aValue ? new Date(aValue) : new Date(0);
                    bValue = bValue ? new Date(bValue) : new Date(0);
                }
                
                if (aValue < bValue) return currentSort.order === 'asc' ? -1 : 1;
                if (aValue > bValue) return currentSort.order === 'asc' ? 1 : -1;
                return 0;
            });
            
            loadCarsData();
        }

        function printTable(tableId, title) {
            const table = document.getElementById(tableId);
            const newWin = window.open('', 'Print-Window');
            
            const tempTable = table.cloneNode(true);
            const noExportCells = tempTable.querySelectorAll('.no-export');
            noExportCells.forEach(cell => {
                if (cell.tagName === 'TH' || cell.tagName === 'TD') {
                    cell.style.display = 'none';
                }
            });
            
            newWin.document.open();
            newWin.document.write(`
                <html>
                <head>
                    <title>Print</title>
                    <style>
                        body { font-family: Arial, sans-serif; direction: rtl; }
                        h1 { text-align: center; margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #000; padding: 8px; text-align: right; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    ${tempTable.outerHTML}
                </body>
                </html>
            `);
            newWin.document.close();
            newWin.print();
            newWin.close();
        }

        function printCarHistory() {
            const carDetails = document.getElementById('carDetails');
            if (carDetails.innerHTML.trim() !== '') {
                printElement(carDetails, 'ÙƒØ´Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©');
            } else {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
            }
        }

        function printElement(element, title) {
            const newWin = window.open('', 'Print-Window');
            newWin.document.open();
            newWin.document.write(`
                <html>
                <head>
                    <title>Print</title>
                    <style>
                        body { font-family: Arial, sans-serif; direction: rtl; }
                        h1 { text-align: center; margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #000; padding: 8px; text-align: right; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    ${element.innerHTML}
                </body>
                </html>
            `);
            newWin.document.close();
            newWin.print();
            newWin.close();
        }

        function exportTableToPDF(tableId, title) {
            const table = document.getElementById(tableId);
            const tempTable = table.cloneNode(true);
            const noExportCells = tempTable.querySelectorAll('.no-export');
            noExportCells.forEach(cell => {
                if (cell.tagName === 'TH' || cell.tagName === 'TD') {
                    cell.style.display = 'none';
                }
            });
            
            const opt = {
                margin: 10,
                filename: `${title}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = `<h2 style="text-align: center; margin-bottom: 20px;">${title}</h2>${tempTable.outerHTML}`;
            
            html2pdf().set(opt).from(tempDiv).save();
        }

        // Ø¯Ø§Ù„Ø© ØªØµØ¯ÙŠØ± ÙƒØ´Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¥Ù„Ù‰ PDF Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ø®ÙÙŠ (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø©)
        async function exportCarHistoryPDF() {
            const carDetails = document.getElementById('carDetails');
            if (carDetails.innerHTML.trim() === '') {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }

            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
            const carNumberElem = carDetails.querySelector('h3');
            if (!carNumberElem) return;
            
            const carNumber = carNumberElem.textContent.replace('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ', '');
            const car = carsData.find(c => c.number === carNumber);
            if (!car) return;

            // ØªØ¬Ù‡ÙŠØ² Ù‚Ø§Ù„Ø¨ PDF
            const template = document.getElementById('pdf-template');
            const originalDisplay = template.style.display;
            const originalPosition = template.style.position;
            const originalLeft = template.style.left;
            const originalTop = template.style.top;

            template.style.display = 'block';
            template.style.position = 'fixed';
            template.style.left = '0';
            template.style.top = '0';
            template.style.zIndex = '10000';

            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            document.getElementById('pdf-car-number').textContent = car.number;
            document.getElementById('pdf-print-date').textContent = new Date().toLocaleDateString('ar-KW');

            const carInfoDiv = document.getElementById('pdf-car-info');
            carInfoDiv.innerHTML = `
                <strong>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</strong> ${car.type} | 
                <strong>Ù…ÙˆØ¯ÙŠÙ„:</strong> ${car.model} | 
                <strong>Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹:</strong> ${car.year} | 
                <strong>Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ±Ø®ÙŠØµ:</strong> ${car.licenseExpiry} | 
                <strong>Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:</strong> ${car.adLicenseExpiry || '-'} | 
                <strong>Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©:</strong> ${car.municipalityLicenseExpiry || '-'} | 
                <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${car.status}
            `;

            const carDeliveries = deliveriesData.filter(d => d.carNumber === car.number);
            const tableBody = document.getElementById('pdf-table-body');
            tableBody.innerHTML = '';

            if (carDeliveries.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</td>`;
                tableBody.appendChild(row);
            } else {
                carDeliveries.forEach(d => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${d.receiveDate}</td>
                        <td>${d.deliveryDate || '-'}</td>
                        <td>${d.driverName}</td>
                        <td>${d.phoneNumber || '-'}</td>
                        <td>${d.restaurant}</td>
                        <td>${d.notes || '-'}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            try {
                const canvas = await html2canvas(template, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#FFFFFF',
                    width: 794,
                    height: 1123,
                    windowWidth: 794,
                    windowHeight: 1123
                });

                const imgData = canvas.toDataURL('image/jpeg', 0.95);
                const pdf = new window.jspdf.jsPDF('p', 'pt', 'a4');
                const imgWidth = pdf.internal.pageSize.getWidth();
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                pdf.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                pdf.save(`ÙƒØ´Ù_Ø¨ÙŠØ§Ù†Ø§Øª_${car.number}.pdf`);

            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF');
            } finally {
                template.style.display = originalDisplay;
                template.style.position = originalPosition;
                template.style.left = originalLeft;
                template.style.top = originalTop;
                template.style.zIndex = '-1000';
            }
        }

        function exportTableToExcel(data, title) {
            try {
                if (!data || (Array.isArray(data) && data.length === 0)) {
                    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                    return;
                }

                const wb = XLSX.utils.book_new();
                let ws;

                if (Array.isArray(data) && data.length > 0 && typeof data[0] === 'object') {
                    ws = XLSX.utils.json_to_sheet(data);
                } else {
                    ws = XLSX.utils.aoa_to_sheet(data);
                }

                if (!ws['!cols']) ws['!cols'] = [];
                const range = XLSX.utils.decode_range(ws['!ref']);
                const numCols = range.e.c - range.s.c + 1;
                
                for (let i = 0; i < numCols; i++) {
                    ws['!cols'][i] = { width: 15 };
                }

                for (let col = range.s.c; col <= range.e.c; col++) {
                    const headerCell = XLSX.utils.encode_cell({ r: range.s.r, c: col });
                    if (!ws[headerCell].s) ws[headerCell].s = {};
                    ws[headerCell].s = {
                        fill: { fgColor: { rgb: "4472C4" } },
                        font: { bold: true, color: { rgb: "FFFFFF" } },
                        alignment: { horizontal: "center", vertical: "center" }
                    };
                }

                for (let row = range.s.r + 1; row <= range.e.r; row++) {
                    for (let col = range.s.c; col <= range.e.c; col++) {
                        const cell = XLSX.utils.encode_cell({ r: row, c: col });
                        if (!ws[cell].s) ws[cell].s = {};
                        ws[cell].s = {
                            fill: { fgColor: { rgb: row % 2 === 0 ? "E6E6E6" : "FFFFFF" } },
                            alignment: { horizontal: "right", vertical: "center" }
                        };
                    }
                }

                for (let row = range.s.r; row <= range.e.r; row++) {
                    for (let col = range.s.c; col <= range.e.c; col++) {
                        const cell = XLSX.utils.encode_cell({ r: row, c: col });
                        if (!ws[cell].s) ws[cell].s = {};
                        if (!ws[cell].s.border) ws[cell].s.border = {};
                        ws[cell].s.border = {
                            top: { style: "thin", color: { rgb: "000000" } },
                            left: { style: "thin", color: { rgb: "000000" } },
                            bottom: { style: "thin", color: { rgb: "000000" } },
                            right: { style: "thin", color: { rgb: "000000" } }
                        };
                    }
                }

                if (!ws['!views']) ws['!views'] = [];
                ws['!views'].push({ rightToLeft: true });

                XLSX.utils.book_append_sheet(wb, ws, "Data");
                XLSX.writeFile(wb, `${title}.xlsx`);
                
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±');
            }
        }

        function exportCarHistoryExcel() {
            const carDetails = document.getElementById('carDetails');
            if (carDetails.innerHTML.trim() !== '') {
                const tables = carDetails.getElementsByTagName('table');
                if (tables.length > 0) {
                    const data = tableToJSON(tables[0]);
                    exportTableToExcel(data, 'ÙƒØ´Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©');
                }
            } else {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
            }
        }

        function tableToJSON(table) {
            const data = [];
            const headers = [];
            
            const headerCells = table.querySelectorAll('thead th');
            headerCells.forEach(cell => {
                headers.push(cell.textContent);
            });
            
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const rowData = {};
                const cells = row.querySelectorAll('td');
                cells.forEach((cell, index) => {
                    if (headers[index]) {
                        rowData[headers[index]] = cell.textContent;
                    }
                });
                data.push(rowData);
            });
            
            return data;
        }

        function loadAlertsData() {
            const tbody = document.getElementById('expiringLicensesTableBody');
            tbody.innerHTML = '';
            
            const today = new Date();
            const nextMonth = new Date();
            nextMonth.setDate(today.getDate() + 30);
            
            const expiringLicenses = carsData.filter(car => {
                const expiryDate = new Date(car.licenseExpiry);
                return expiryDate >= today && expiryDate <= nextMonth;
            });

            const expiringAdLicenses = carsData.filter(car => {
                if (!car.adLicenseExpiry) return false;
                const expiryDate = new Date(car.adLicenseExpiry);
                return expiryDate >= today && expiryDate <= nextMonth;
            });
            
            const expiredLicenses = carsData.filter(car => {
                const expiryDate = new Date(car.licenseExpiry);
                return expiryDate < today;
            });

            const expiredAdLicenses = carsData.filter(car => {
                if (!car.adLicenseExpiry) return false;
                const expiryDate = new Date(car.adLicenseExpiry);
                return expiryDate < today;
            });
            
            if (expiringLicenses.length === 0 && expiringAdLicenses.length === 0 && 
                expiredLicenses.length === 0 && expiredAdLicenses.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="4" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ±Ø§Ø®ÙŠØµ Ù…Ù†ØªÙ‡ÙŠØ©</td>`;
                tbody.appendChild(row);
                return;
            }
            
            expiringLicenses.forEach(car => {
                const expiryDate = new Date(car.licenseExpiry);
                const daysRemaining = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                
                let daysClass = 'days-normal';
                if (daysRemaining <= 7) {
                    daysClass = 'days-critical';
                } else if (daysRemaining <= 15) {
                    daysClass = 'days-warning';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${car.number}</td>
                    <td>ØªØ±Ø®ÙŠØµ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</td>
                    <td>${car.licenseExpiry}</td>
                    <td><span class="days-remaining ${daysClass}">${daysRemaining} ÙŠÙˆÙ…</span></td>
                `;
                tbody.appendChild(row);
            });
            
            expiringAdLicenses.forEach(car => {
                const expiryDate = new Date(car.adLicenseExpiry);
                const daysRemaining = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                
                let daysClass = 'days-normal';
                if (daysRemaining <= 7) {
                    daysClass = 'days-critical';
                } else if (daysRemaining <= 15) {
                    daysClass = 'days-warning';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${car.number}</td>
                    <td>ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</td>
                    <td>${car.adLicenseExpiry}</td>
                    <td><span class="days-remaining ${daysClass}">${daysRemaining} ÙŠÙˆÙ…</span></td>
                `;
                tbody.appendChild(row);
            });
            
            expiredLicenses.forEach(car => {
                const expiryDate = new Date(car.licenseExpiry);
                const daysRemaining = Math.floor((today - expiryDate) / (1000 * 60 * 60 * 24));
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${car.number}</td>
                    <td>ØªØ±Ø®ÙŠØµ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</td>
                    <td>${car.licenseExpiry}</td>
                    <td><span class="days-remaining days-expired">-${daysRemaining} ÙŠÙˆÙ…</span></td>
                `;
                tbody.appendChild(row);
            });
            
            expiredAdLicenses.forEach(car => {
                const expiryDate = new Date(car.adLicenseExpiry);
                const daysRemaining = Math.floor((today - expiryDate) / (1000 * 60 * 60 * 24));
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${car.number}</td>
                    <td>ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</td>
                    <td>${car.adLicenseExpiry}</td>
                    <td><span class="days-remaining days-expired">-${daysRemaining} ÙŠÙˆÙ…</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function exportAlertsToExcel() {
            const today = new Date();
            const nextMonth = new Date();
            nextMonth.setDate(today.getDate() + 30);
            
            const expiringLicenses = carsData.filter(car => {
                const expiryDate = new Date(car.licenseExpiry);
                return expiryDate >= today && expiryDate <= nextMonth;
            });

            const expiringAdLicenses = carsData.filter(car => {
                if (!car.adLicenseExpiry) return false;
                const expiryDate = new Date(car.adLicenseExpiry);
                return expiryDate >= today && expiryDate <= nextMonth;
            });
            
            const expiredLicenses = carsData.filter(car => {
                const expiryDate = new Date(car.licenseExpiry);
                return expiryDate < today;
            });

            const expiredAdLicenses = carsData.filter(car => {
                if (!car.adLicenseExpiry) return false;
                const expiryDate = new Date(car.adLicenseExpiry);
                return expiryDate < today;
            });
            
            const alertsData = [];
            
            expiringLicenses.forEach(car => {
                const expiryDate = new Date(car.licenseExpiry);
                const daysRemaining = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                
                alertsData.push({
                    'Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©': car.number,
                    'Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ': 'ØªØ±Ø®ÙŠØµ Ø§Ù„Ø³ÙŠØ§Ø±Ø©',
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡': car.licenseExpiry,
                    'Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©': daysRemaining
                });
            });
            
            expiringAdLicenses.forEach(car => {
                const expiryDate = new Date(car.adLicenseExpiry);
                const daysRemaining = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                
                alertsData.push({
                    'Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©': car.number,
                    'Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ': 'ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†',
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡': car.adLicenseExpiry,
                    'Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©': daysRemaining
                });
            });
            
            expiredLicenses.forEach(car => {
                const expiryDate = new Date(car.licenseExpiry);
                const daysRemaining = Math.floor((today - expiryDate) / (1000 * 60 * 60 * 24));
                
                alertsData.push({
                    'Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©': car.number,
                    'Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ': 'ØªØ±Ø®ÙŠØµ Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ù…Ù†ØªÙ‡ÙŠ)',
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡': car.licenseExpiry,
                    'Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©': -daysRemaining
                });
            });
            
            expiredAdLicenses.forEach(car => {
                const expiryDate = new Date(car.adLicenseExpiry);
                const daysRemaining = Math.floor((today - expiryDate) / (1000 * 60 * 60 * 24));
                
                alertsData.push({
                    'Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©': car.number,
                    'Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ': 'ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ù…Ù†ØªÙ‡ÙŠ)',
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡': car.adLicenseExpiry,
                    'Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©': -daysRemaining
                });
            });
            
            if (alertsData.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }
            
            exportTableToExcel(alertsData, 'Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª');
        }

        function generateReport(type) {
            let reportData = [];
            let title = '';
            let description = '';
            
            if (type === 'monthly') {
                title = 'ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ';
                description = 'Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª Ø®Ù„Ø§Ù„ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ';
                reportData = deliveriesData.filter(d => {
                    const receiveDate = new Date(d.receiveDate);
                    const currentMonth = new Date().getMonth();
                    const currentYear = new Date().getFullYear();
                    return receiveDate.getMonth() === currentMonth && receiveDate.getFullYear() === currentYear;
                });
            } else if (type === 'yearly') {
                title = 'ØªÙ‚Ø±ÙŠØ± Ø³Ù†ÙˆÙŠ';
                description = 'Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª Ø®Ù„Ø§Ù„ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©';
                reportData = deliveriesData.filter(d => {
                    const receiveDate = new Date(d.receiveDate);
                    const currentYear = new Date().getFullYear();
                    return receiveDate.getFullYear() === currentYear;
                });
            } else if (type === 'expiry') {
                title = 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©';
                description = 'Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø®Ù„Ø§Ù„ 30 ÙŠÙˆÙ…';
                const today = new Date();
                const nextMonth = new Date();
                nextMonth.setDate(today.getDate() + 30);
                
                reportData = carsData.filter(car => {
                    const expiryDate = new Date(car.licenseExpiry);
                    return expiryDate >= today && expiryDate <= nextMonth;
                });
            }
            
            const reportResults = document.getElementById('reportResults');
            
            if (reportData.length === 0) {
                reportResults.innerHTML = `
                    <h3>${title}</h3>
                    <p>${description}</p>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>
                `;
                return;
            }
            
            reportResults.innerHTML = `
                <h3>${title}</h3>
                <p>${description}</p>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                            <th>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                            <th>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                            <th>${type === 'expiry' ? 'ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ±Ø®ÙŠØµ' : 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…'}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${reportData.map(item => `
                            <tr>
                                <td>${type === 'expiry' ? item.number : item.carNumber}</td>
                                <td>${type === 'expiry' ? item.type : ''}</td>
                                <td>${type === 'expiry' ? item.model : ''}</td>
                                <td>${type === 'expiry' ? item.licenseExpiry : item.receiveDate}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function generateReportData() {
            return [
                ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', carsData.length],
                ['Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©', carsData.filter(car => car.status === 'Ù†Ø´Ø·Ø©').length],
                ['Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©', carsData.filter(car => car.status === 'ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©').length],
                ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹', restaurantsData.length],
                ['Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ø´Ø·Ø©', deliveriesData.filter(d => !d.deliveryDate).length]
            ];
        }

        function importFromExcel(type, file) {
            if (!file) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { 
                    type: 'array',
                    cellDates: true,
                    cellText: false
                });
                
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                const jsonData = XLSX.utils.sheet_to_json(worksheet, {
                    raw: false,
                    dateNF: 'yyyy-mm-dd'
                });
                
                if (type === 'cars') {
                    jsonData.forEach(item => {
                        let licenseExpiry = item['ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ±Ø®ÙŠØµ'] || item['License Expiry'];
                        let adLicenseExpiry = item['ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†'] || item['Ad License Expiry'];
                        let municipalityLicenseExpiry = item['ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©'] || item['Municipality License Expiry'];
                        
                        licenseExpiry = formatExcelDate(licenseExpiry);
                        adLicenseExpiry = formatExcelDate(adLicenseExpiry);
                        municipalityLicenseExpiry = formatExcelDate(municipalityLicenseExpiry);
                        
                        const newCar = {
                            id: carsData.length > 0 ? Math.max(...carsData.map(c => c.id)) + 1 : 1,
                            number: item['Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©'] || item['Car Number'],
                            type: item['Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©'] || item['Car Type'],
                            model: item['Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©'] || item['Car Model'],
                            year: parseInt(item['Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹'] || item['Manufacturing Year']),
                            licenseExpiry: licenseExpiry,
                            adLicenseExpiry: adLicenseExpiry || null,
                            municipalityLicenseExpiry: municipalityLicenseExpiry || null,
                            status: item['Ø§Ù„Ø­Ø§Ù„Ø©'] || item['Status'] || 'Ù†Ø´Ø·Ø©'
                        };
                        
                        carsData.push(newCar);
                    });
                    
                    saveAllData();
                    loadCarsData();
                    updateStats();
                    updateAlertsBar();
                    checkLicenseExpiry();
                    alert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                } else if (type === 'restaurants') {
                    jsonData.forEach(item => {
                        const newRestaurant = {
                            id: restaurantsData.length > 0 ? Math.max(...restaurantsData.map(r => r.id)) + 1 : 1,
                            name: item['Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹'] || item['Location Name']
                        };
                        
                        restaurantsData.push(newRestaurant);
                    });
                    
                    saveAllData();
                    loadRestaurantsData();
                    updateStats();
                    alert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        function formatExcelDate(dateValue) {
            if (!dateValue) return '';
            
            if (dateValue instanceof Date) {
                return dateValue.toISOString().split('T')[0];
            }
            
            if (typeof dateValue === 'number') {
                const excelEpoch = new Date(1899, 11, 30);
                const jsDate = new Date(excelEpoch.getTime() + dateValue * 24 * 60 * 60 * 1000);
                return jsDate.toISOString().split('T')[0];
            }
            
            if (typeof dateValue === 'string') {
                const dateFormats = [
                    /(\d{4})-(\d{2})-(\d{2})/,
                    /(\d{2})\/(\d{2})\/(\d{4})/,
                    /(\d{2})-(\d{2})-(\d{4})/,
                    /(\d{4})\/(\d{2})\/(\d{2})/
                ];
                
                for (let format of dateFormats) {
                    const match = dateValue.match(format);
                    if (match) {
                        if (format === dateFormats[0]) {
                            return dateValue;
                        } else if (format === dateFormats[1]) {
                            return `${match[3]}-${match[1].padStart(2, '0')}-${match[2].padStart(2, '0')}`;
                        } else if (format === dateFormats[2]) {
                            return `${match[3]}-${match[2].padStart(2, '0')}-${match[1].padStart(2, '0')}`;
                        } else if (format === dateFormats[3]) {
                            return `${match[1]}-${match[2].padStart(2, '0')}-${match[3].padStart(2, '0')}`;
                        }
                    }
                }
                
                return dateValue;
            }
            
            return '';
        }

        function downloadTemplate() {
            const wb = XLSX.utils.book_new();
            
            const carsData = [
                ['Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹', 'ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ±Ø®ÙŠØµ', 'ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©', 'Ø§Ù„Ø­Ø§Ù„Ø©'],
                ['16/8826', 'ØªÙˆÙŠÙˆØªØ§', '1994', 1994, '2026-03-10', '2026-06-17', '2026-03-10', 'Ù†Ø´Ø·Ø©'],
                ['8/5056', 'ØªÙˆÙŠÙˆØªØ§', '1996', 1996, '2026-08-10', '', '', 'Ù†Ø´Ø·Ø©']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(carsData);
            
            if (!ws['!cols']) ws['!cols'] = [];
            ws['!cols'][0] = { width: 15 };
            ws['!cols'][1] = { width: 15 };
            ws['!cols'][2] = { width: 15 };
            ws['!cols'][3] = { width: 12 };
            ws['!cols'][4] = { width: 20 };
            ws['!cols'][5] = { width: 25 };
            ws['!cols'][6] = { width: 25 };
            ws['!cols'][7] = { width: 15 };
            
            for (let R = 1; R <= 2; R++) {
                const licenseCell = XLSX.utils.encode_cell({r: R, c: 4});
                if (!ws[licenseCell]) ws[licenseCell] = {};
                ws[licenseCell].t = 'd';
                ws[licenseCell].z = 'yyyy-mm-dd';
                
                const adLicenseCell = XLSX.utils.encode_cell({r: R, c: 5});
                if (!ws[adLicenseCell]) ws[adLicenseCell] = {};
                ws[adLicenseCell].t = 'd';
                ws[adLicenseCell].z = 'yyyy-mm-dd';
                
                const municipalityCell = XLSX.utils.encode_cell({r: R, c: 6});
                if (!ws[municipalityCell]) ws[municipalityCell] = {};
                ws[municipalityCell].t = 'd';
                ws[municipalityCell].z = 'yyyy-mm-dd';
            }
            
            const instructions = [
                [''],
                ['ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ¹Ø¨Ø¦Ø©:'],
                ['1. ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø¨ØµÙŠØºØ© YYYY-MM-DD (Ù…Ø«Ø§Ù„: 2026-12-31)'],
                ['2. Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø±Ù‚Ù…Ø§Ù‹ ØµØ­ÙŠØ­Ø§Ù‹'],
                ['3. Ø§Ù„Ø­Ø§Ù„Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙˆØ§Ø­Ø¯Ø© Ù…Ù†: Ù†Ø´Ø·Ø©ØŒ ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©ØŒ ØºÙŠØ± Ù†Ø´Ø·Ø©'],
                ['4. Ù„Ø§ ØªÙ‚Ù… Ø¨ØªØºÙŠÙŠØ± ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙÙŠ Excel'],
                ['5. Ø§Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨ØµÙŠØºØ© .xlsx']
            ];
            
            const instructionRange = XLSX.utils.decode_range(ws['!ref']);
            const startRow = instructionRange.e.r + 2;
            
            instructions.forEach((instruction, index) => {
                instruction.forEach((cell, colIndex) => {
                    const cellAddress = XLSX.utils.encode_cell({r: startRow + index, c: colIndex});
                    if (!ws[cellAddress]) ws[cellAddress] = {};
                    ws[cellAddress].v = cell;
                    
                    if (index === 0) {
                        ws[cellAddress].s = { font: { bold: true, color: { rgb: "FF0000" } } };
                    }
                });
            });
            
            XLSX.utils.book_append_sheet(wb, ws, "Cars Template");
            XLSX.writeFile(wb, "Cars_Template.xlsx");
        }

        function showSyncNotification(message, type) {
            let notification = document.getElementById('syncNotification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'syncNotification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: bold;
                    z-index: 10000;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    max-width: 300px;
                    text-align: center;
                `;
                document.body.appendChild(notification);
            }
            
            if (type === 'success') {
                notification.style.backgroundColor = '#2ecc71';
            } else if (type === 'error') {
                notification.style.backgroundColor = '#e74c3c';
            } else {
                notification.style.backgroundColor = '#3498db';
            }
            
            notification.textContent = message;
            notification.style.display = 'block';
            notification.style.opacity = '1';
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
